<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Physics - Fish Fight Documentation</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Community</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="code_of_conduct.html"><strong aria-hidden="true">1.1.</strong> Code of Conduct</a></li><li class="chapter-item expanded "><a href="gameplay.html"><strong aria-hidden="true">1.2.</strong> Gameplay</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="controls.html"><strong aria-hidden="true">1.2.1.</strong> Controls</a></li><li class="chapter-item expanded "><a href="items.html"><strong aria-hidden="true">1.2.2.</strong> Items</a></li><li class="chapter-item expanded "><a href="multiplayer.html"><strong aria-hidden="true">1.2.3.</strong> Multiplayer</a></li></ol></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">1.3.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contributing_code.html"><strong aria-hidden="true">1.3.1.</strong> Contributing Code</a></li><li class="chapter-item expanded "><a href="simple_gun_weapon.html"><strong aria-hidden="true">1.3.2.</strong> Simple Gun Weapon</a></li><li class="chapter-item expanded "><a href="contributing_art.html"><strong aria-hidden="true">1.3.3.</strong> Contributing Art</a></li></ol></li><li class="chapter-item expanded "><a href="docs/releases.html"><strong aria-hidden="true">1.4.</strong> Releases</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="09-12-2021.html"><strong aria-hidden="true">1.4.1.</strong> 0.3</a></li></ol></li><li class="chapter-item expanded "><a href="credits.html"><strong aria-hidden="true">1.5.</strong> Credits</a></li></ol></li><li class="chapter-item expanded "><a href="mechanics.html"><strong aria-hidden="true">2.</strong> Dev</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="physics.html" class="active"><strong aria-hidden="true">2.1.</strong> Physics</a></li><li class="chapter-item expanded "><a href="environmental_weapons.html"><strong aria-hidden="true">2.2.</strong> Environmental Weapons</a></li><li class="chapter-item expanded "><a href="netcode.html"><strong aria-hidden="true">2.3.</strong> Netcode</a></li><li class="chapter-item expanded "><a href="juice.html"><strong aria-hidden="true">2.4.</strong> Juice</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="docs/screenshake.html"><strong aria-hidden="true">2.4.1.</strong> Screen Shake</a></li><li class="chapter-item expanded "><a href="docs/particles.html"><strong aria-hidden="true">2.4.2.</strong> Particles</a></li></ol></li><li class="chapter-item expanded "><a href="editor.html"><strong aria-hidden="true">2.5.</strong> Editor</a></li></ol></li><li class="chapter-item expanded "><a href="documentation.html"><strong aria-hidden="true">3.</strong> Platformer Guide</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Fish Fight Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/fishfight/jumpy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#physics" id="physics">Physics</a></h1>
<p>As you might already know, Fish Fight is a homage to the excellent Duck Game and thus we have chosen to replicate the rather simple and straight forward linear physics found in that game. It follows standard platformer physics, with force being translated to two-dimensional velocity, acting against gravity and drag, every physics update (<code>fixed_update</code>).</p>
<p><a href="https://maddythorson.medium.com/celeste-and-towerfall-physics-d24bd2ae0fc5">The same physics system is used in Towerfall and Celeste.</a></p>
<p>To learn more about basic game physics, as they are implemented in Fish Fight, you can explore the following sources:</p>
<p><code>[Ask us about missing links!]</code></p>
<h2><a class="header" href="#fish-fights-physics-implementation" id="fish-fights-physics-implementation">Fish Fight's physics implementation</a></h2>
<p>As for the specifics of Fish Fight, I will elaborate in the following paragraphs. Please note, however, that the game is currently in a very early prototype stage, so the implementation is neither perfect nor, in any way, optimized, at this stage.</p>
<h3><a class="header" href="#scene-nodes" id="scene-nodes">Scene nodes</a></h3>
<p>The game uses the <a href="https://github.com/not-fl3/macroquad">Macroquad library</a>, by <a href="https://github.com/not-fl3">Fedor</a>, who is also part of the core team of Fish Fight. This means that our scenes are composed of scene nodes, made by implementing the <code>Node</code> type. The most relevant method, when discussing physics, is the <code>fixed_update</code> method, which is called for every node, every physics frame. This means that, in order to explore the existing physics of any existing in-game object, you should browse to the corresponding node source file, in <a href="https://github.com/fishfight/fish2/tree/master/src/nodes"><code>src/nodes</code></a>, and look for the <code>impl Node for T</code> section and the encapsulated <code>fixed_update</code> implementation.</p>
<p>This method takes a <code>RefMut&lt;T&gt;</code> as an argument (can be both mutable and immutable), where <code>T</code> is the type of the node that it is being implemented for. From here, you can do many things; like manipulating the node, itself, through the <code>RefMut&lt;T&gt;</code> parameter, as well as access other nodes by fetching them from the scene, either by type, or by specific traits, made by calling <code>node.provides([...])</code> in a nodes <code>ready</code> implementation. For examples of this, you can check the code of most nodes for the code providing the <code>Sproingable</code> trait, for example.</p>
<p>Examples of code for accessing other nodes:</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>// This is from the ArmedGrenade node, showing how we iterate over players, checking for
// collision and killing the player if the explosion &quot;collides&quot; with the player
for mut player in scene::find_nodes_by_type::&lt;crate::nodes::Player&gt;() {
    let intersect =
        grenade_rect.intersect(Rect::new(
            player.body.pos.x,
            player.body.pos.y,
            PLAYER_HITBOX_WIDTH,
            PLAYER_HITBOX_HEIGHT,
        ));
    if !intersect.is_none() {
        let direction = node.body.pos.x &gt; (player.body.pos.x + 10.);
        scene::find_node_by_type::&lt;crate::nodes::Camera&gt;()
            .unwrap()
            .shake();
        player.kill(direction);
    }
}
<span class="boring">}
</span></code></pre></pre>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>// This is from the Sproinger node, iterating through nodes providing the Sproingable trait
// and checking for collision, before performing a &quot;sproing&quot; on them, if they overlap
for (_actor, mut body_lens, size) in scene::find_nodes_with::&lt;Sproingable&gt;() {
    if body_lens.get().is_some() {
        let body = body_lens.get().unwrap();
        if body.speed.length() &gt; Self::STOPPED_THRESHOLD {
            let intersect = sproinger_rect
                .intersect(Rect::new(body.pos.x, body.pos.y, size.x, size.y));
            if !intersect.is_none() {
                let resources = storage::get_mut::&lt;Resources&gt;();
                play_sound_once(resources.jump_sound);

                body.speed.y = -Self::FORCE;
                node.has_sproinged = true;
                // self.sprite.set_animation(1);
                // self.sprite.playing = true;
                Sproinger::animate(node.handle());
            }
        }
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#collision" id="collision">Collision</a></h3>
<p>Collision between nodes is done by creating collider <code>Rect</code> or <code>Circle</code> objects and calling their <code>intersect</code> (<code>Rect</code> only) or <code>overlaps</code> methods. The former will return an<code>Option&lt;Rect&gt;</code>, where the contained <code>Rect</code> represents the intersection between the two colliding <code>Rect</code> objects, or <code>None</code>, if there was no intersection. The latter will return a <code>bool</code> that is <code>true</code> if there was any overlap between the two objects. To check for collisions with the map, you have several methods in the <code>scene</code> module that lets you check for collisions on the various map layers. For examples of map collisions, once again, the <a href="https://github.com/fishfight/fish2/tree/master/src/nodes/player.rs"><code>Player</code></a> implementation is a good place to start. Furthermore, <code>PhysicsBody</code> members may hold a collider that Macroquads physics engine will collide against <code>Solid</code> objects in the scene (ground tiles, for the most part). These colliders will have to be added to the collision world, as actors. See the constructor of the <a href="https://github.com/fishfight/fish2/tree/master/src/nodes/player.rs"><code>player node</code></a> for an example of how this is done.</p>
<p>NOTE: To get the hitbox of a Player node, use <code>Player::get_hitbox()</code>, so that you get the correct size if the player node, for example, is in a crouched state.</p>
<h3><a class="header" href="#force" id="force">Force</a></h3>
<p>When it comes to enacting force on nodes, this is done by setting a speed on a node. Most nodes will have a body, but not all, as the primary use for a body is to hold a collider. For simpler nodes, we might just put a position vector and a speed vector directly on the node, in stead. This can be checked in the specific nodes implementation. As mentioned, we set the velocity directly, in stead of accumulating force over several frames, as this leads to much more predictable and precise game physics (the age old Mario, using acceleration, vs Megaman, using binary force, dichotomy).</p>
<p>This means that, in order to implement an explosion, for example, you would decide on a force, find the node(s) that the explosion will act upon and apply this force by setting the speed of the node, or the nodes body, depending on its implementation, to the value of the force in the appropriate direction. See below for a simplified example of something exerting a force, on the x-axis, on a player, if an arbitrary hit check condition is fulfilled:</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>impl T {
    pub const FORCE: f32 = 900.0;
}

impl Node for T {
    for mut player in scene::find_nodes_by_type::&lt;crate::nodes::Player&gt;() {
        [hit detection]
        if is_hit {
            let direction_is_right = node.body.pos.x &gt; (player.body.pos.x + 10.);
            player.body.speed.x = if direction_is_right {
                FORCE
            } else {
                -FORCE // negative force
            }
        }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>The same methods would be used for movement, for example, but instead of checking for a collision, you would check for input. For examples of this, check out the <a href="https://github.com/fishfight/fish2/tree/master/src/nodes/player.rs"><code>player node implementation</code></a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="mechanics.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="environmental_weapons.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="mechanics.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="environmental_weapons.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
